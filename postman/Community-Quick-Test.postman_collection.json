{
  "info": {
    "name": "Community Quick Test",
    "description": "å¾®ç¤¾åŒºåŠŸèƒ½å¿«é€Ÿæµ‹è¯•é›†åˆ - åŒ…å«å¸¸ç”¨çš„ç¤¾åŒºåŠŸèƒ½æµ‹è¯•ç”¨ä¾‹",
    "version": "1.0.0"
  },
  "item": [
    {
      "name": "ğŸš€ å¿«é€Ÿæµ‹è¯•æµç¨‹",
      "item": [
        {
          "name": "1. ç”¨æˆ·ç™»å½•",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@alcms.com\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "login"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('ç™»å½•æˆåŠŸ', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('accessToken');",
                  "    pm.environment.set('accessToken', jsonData.data.accessToken);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "2. è·å–æ¿å—åˆ—è¡¨",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/community/boards",
              "host": ["{{baseUrl}}"],
              "path": ["api", "community", "boards"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('è·å–æ¿å—åˆ—è¡¨æˆåŠŸ', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.be.an('array');",
                  "    if (jsonData.data.length > 0) {",
                  "        pm.environment.set('testBoardId', jsonData.data[0].id);",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "3. åˆ›å»ºæµ‹è¯•å¸–å­",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"æµ‹è¯•å¸–å­ - APIè‡ªåŠ¨åŒ–æµ‹è¯•\",\n  \"content\": \"# è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å¸–å­\\n\\nè¿™ä¸ªå¸–å­æ˜¯é€šè¿‡APIè‡ªåŠ¨åˆ›å»ºçš„ï¼Œç”¨äºæµ‹è¯•ç¤¾åŒºåŠŸèƒ½ã€‚\\n\\n## æµ‹è¯•å†…å®¹\\n\\n- Markdownæ ¼å¼æ”¯æŒ\\n- è‡ªåŠ¨åŒ–APIæµ‹è¯•\\n- ç¤¾åŒºåŠŸèƒ½éªŒè¯\\n\\n**æµ‹è¯•æ—¶é—´**: \" + new Date().toISOString(),\n  \"contentType\": \"markdown\",\n  \"summary\": \"APIè‡ªåŠ¨åŒ–æµ‹è¯•å¸–å­\",\n  \"boardId\": {{testBoardId}},\n  \"status\": \"published\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/community/posts",
              "host": ["{{baseUrl}}"],
              "path": ["api", "community", "posts"]
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// åŠ¨æ€è®¾ç½®boardId",
                  "const boardId = pm.environment.get('testBoardId') || 23;",
                  "const requestBody = JSON.parse(pm.request.body.raw);",
                  "requestBody.boardId = parseInt(boardId);",
                  "requestBody.content += new Date().toISOString();",
                  "pm.request.body.raw = JSON.stringify(requestBody);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('åˆ›å»ºå¸–å­æˆåŠŸ', function () {",
                  "    pm.response.to.have.status(201);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('id');",
                  "    pm.environment.set('testPostId', jsonData.data.id);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "4. è·å–å¸–å­è¯¦æƒ…",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/community/posts/{{testPostId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "community", "posts", "{{testPostId}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('è·å–å¸–å­è¯¦æƒ…æˆåŠŸ', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('title');",
                  "    pm.expect(jsonData.data).to.have.property('content');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "5. åˆ›å»ºè¯„è®º",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"content\": \"è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•è¯„è®ºï¼Œé€šè¿‡APIè‡ªåŠ¨åˆ›å»ºã€‚æµ‹è¯•æ—¶é—´ï¼š\" + new Date().toISOString(),\n  \"postId\": {{testPostId}}\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/community/comments",
              "host": ["{{baseUrl}}"],
              "path": ["api", "community", "comments"]
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "const postId = pm.environment.get('testPostId');",
                  "const requestBody = JSON.parse(pm.request.body.raw);",
                  "requestBody.postId = parseInt(postId);",
                  "requestBody.content += new Date().toISOString();",
                  "pm.request.body.raw = JSON.stringify(requestBody);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('åˆ›å»ºè¯„è®ºæˆåŠŸ', function () {",
                  "    pm.response.to.have.status(201);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('id');",
                  "    pm.environment.set('testCommentId', jsonData.data.id);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "6. ç‚¹èµå¸–å­",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"targetType\": \"post\",\n  \"targetId\": {{testPostId}}\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/community/interactions/like",
              "host": ["{{baseUrl}}"],
              "path": ["api", "community", "interactions", "like"]
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "const postId = pm.environment.get('testPostId');",
                  "const requestBody = JSON.parse(pm.request.body.raw);",
                  "requestBody.targetId = parseInt(postId);",
                  "pm.request.body.raw = JSON.stringify(requestBody);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('ç‚¹èµå¸–å­æˆåŠŸ', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('action');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "7. æ”¶è—å¸–å­",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"postId\": {{testPostId}}\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/community/interactions/favorite",
              "host": ["{{baseUrl}}"],
              "path": ["api", "community", "interactions", "favorite"]
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "const postId = pm.environment.get('testPostId');",
                  "const requestBody = JSON.parse(pm.request.body.raw);",
                  "requestBody.postId = parseInt(postId);",
                  "pm.request.body.raw = JSON.stringify(requestBody);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('æ”¶è—å¸–å­æˆåŠŸ', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('action');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "8. è·å–å¸–å­è¯„è®º",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/community/posts/{{testPostId}}/comments",
              "host": ["{{baseUrl}}"],
              "path": ["api", "community", "posts", "{{testPostId}}", "comments"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('è·å–è¯„è®ºåˆ—è¡¨æˆåŠŸ', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('data');",
                  "    pm.expect(jsonData.data.data).to.be.an('array');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "ğŸ§¹ æ¸…ç†æµ‹è¯•æ•°æ®",
      "item": [
        {
          "name": "åˆ é™¤æµ‹è¯•è¯„è®º",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/community/comments/{{testCommentId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "community", "comments", "{{testCommentId}}"]
            }
          }
        },
        {
          "name": "åˆ é™¤æµ‹è¯•å¸–å­",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/community/posts/{{testPostId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "community", "posts", "{{testPostId}}"]
            }
          }
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "exec": [
          "// è®¾ç½®é»˜è®¤baseUrl",
          "if (!pm.environment.get('baseUrl')) {",
          "    pm.environment.set('baseUrl', 'http://localhost:3000');",
          "}"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "exec": [
          "// å…¨å±€æµ‹è¯•è„šæœ¬",
          "pm.test('Response time is less than 5000ms', function () {",
          "    pm.expect(pm.response.responseTime).to.be.below(5000);",
          "});",
          "",
          "// è®°å½•å“åº”æ—¶é—´",
          "console.log(`Request: ${pm.request.method} ${pm.request.url}`);",
          "console.log(`Response Time: ${pm.response.responseTime}ms`);",
          "console.log(`Status: ${pm.response.status} ${pm.response.reason()}`);",
          "console.log('---');"
        ]
      }
    }
  ]
}
