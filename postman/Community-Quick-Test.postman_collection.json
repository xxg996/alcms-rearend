{
  "info": {
    "name": "Community Quick Test",
    "description": "微社区功能快速测试集合 - 包含常用的社区功能测试用例",
    "version": "1.0.0"
  },
  "item": [
    {
      "name": "🚀 快速测试流程",
      "item": [
        {
          "name": "1. 用户登录",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@alcms.com\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "login"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('登录成功', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('accessToken');",
                  "    pm.environment.set('accessToken', jsonData.data.accessToken);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "2. 获取板块列表",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/community/boards",
              "host": ["{{baseUrl}}"],
              "path": ["api", "community", "boards"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('获取板块列表成功', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.be.an('array');",
                  "    if (jsonData.data.length > 0) {",
                  "        pm.environment.set('testBoardId', jsonData.data[0].id);",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "3. 创建测试帖子",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"测试帖子 - API自动化测试\",\n  \"content\": \"# 这是一个测试帖子\\n\\n这个帖子是通过API自动创建的，用于测试社区功能。\\n\\n## 测试内容\\n\\n- Markdown格式支持\\n- 自动化API测试\\n- 社区功能验证\\n\\n**测试时间**: \" + new Date().toISOString(),\n  \"contentType\": \"markdown\",\n  \"summary\": \"API自动化测试帖子\",\n  \"boardId\": {{testBoardId}},\n  \"status\": \"published\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/community/posts",
              "host": ["{{baseUrl}}"],
              "path": ["api", "community", "posts"]
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// 动态设置boardId",
                  "const boardId = pm.environment.get('testBoardId') || 23;",
                  "const requestBody = JSON.parse(pm.request.body.raw);",
                  "requestBody.boardId = parseInt(boardId);",
                  "requestBody.content += new Date().toISOString();",
                  "pm.request.body.raw = JSON.stringify(requestBody);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('创建帖子成功', function () {",
                  "    pm.response.to.have.status(201);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('id');",
                  "    pm.environment.set('testPostId', jsonData.data.id);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "4. 获取帖子详情",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/community/posts/{{testPostId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "community", "posts", "{{testPostId}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('获取帖子详情成功', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('title');",
                  "    pm.expect(jsonData.data).to.have.property('content');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "5. 创建评论",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"content\": \"这是一个测试评论，通过API自动创建。测试时间：\" + new Date().toISOString(),\n  \"postId\": {{testPostId}}\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/community/comments",
              "host": ["{{baseUrl}}"],
              "path": ["api", "community", "comments"]
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "const postId = pm.environment.get('testPostId');",
                  "const requestBody = JSON.parse(pm.request.body.raw);",
                  "requestBody.postId = parseInt(postId);",
                  "requestBody.content += new Date().toISOString();",
                  "pm.request.body.raw = JSON.stringify(requestBody);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('创建评论成功', function () {",
                  "    pm.response.to.have.status(201);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('id');",
                  "    pm.environment.set('testCommentId', jsonData.data.id);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "6. 点赞帖子",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"targetType\": \"post\",\n  \"targetId\": {{testPostId}}\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/community/interactions/like",
              "host": ["{{baseUrl}}"],
              "path": ["api", "community", "interactions", "like"]
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "const postId = pm.environment.get('testPostId');",
                  "const requestBody = JSON.parse(pm.request.body.raw);",
                  "requestBody.targetId = parseInt(postId);",
                  "pm.request.body.raw = JSON.stringify(requestBody);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('点赞帖子成功', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('action');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "7. 收藏帖子",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"postId\": {{testPostId}}\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/community/interactions/favorite",
              "host": ["{{baseUrl}}"],
              "path": ["api", "community", "interactions", "favorite"]
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "const postId = pm.environment.get('testPostId');",
                  "const requestBody = JSON.parse(pm.request.body.raw);",
                  "requestBody.postId = parseInt(postId);",
                  "pm.request.body.raw = JSON.stringify(requestBody);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('收藏帖子成功', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('action');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "8. 获取帖子评论",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/community/posts/{{testPostId}}/comments",
              "host": ["{{baseUrl}}"],
              "path": ["api", "community", "posts", "{{testPostId}}", "comments"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('获取评论列表成功', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('data');",
                  "    pm.expect(jsonData.data.data).to.be.an('array');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "🧹 清理测试数据",
      "item": [
        {
          "name": "删除测试评论",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/community/comments/{{testCommentId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "community", "comments", "{{testCommentId}}"]
            }
          }
        },
        {
          "name": "删除测试帖子",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/community/posts/{{testPostId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "community", "posts", "{{testPostId}}"]
            }
          }
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "exec": [
          "// 设置默认baseUrl",
          "if (!pm.environment.get('baseUrl')) {",
          "    pm.environment.set('baseUrl', 'http://localhost:3000');",
          "}"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "exec": [
          "// 全局测试脚本",
          "pm.test('Response time is less than 5000ms', function () {",
          "    pm.expect(pm.response.responseTime).to.be.below(5000);",
          "});",
          "",
          "// 记录响应时间",
          "console.log(`Request: ${pm.request.method} ${pm.request.url}`);",
          "console.log(`Response Time: ${pm.response.responseTime}ms`);",
          "console.log(`Status: ${pm.response.status} ${pm.response.reason()}`);",
          "console.log('---');"
        ]
      }
    }
  ]
}
